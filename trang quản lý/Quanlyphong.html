<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Quản Lý Phòng</title>
    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Sử dụng font Inter làm font chữ mặc định */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Tùy chỉnh thanh cuộn cho đẹp hơn */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="fixed inset-y-0 left-0 z-30 w-64 h-full bg-gray-800 text-white transform -translate-x-full transition-transform duration-300 ease-in-out md:translate-x-0" id="sidebar">
            <div class="p-4">
                <a href="#" class="flex items-center space-x-2 text-2xl font-bold">
                    <!-- Icon logo đơn giản -->
                    <svg class="w-8 h-8 text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h6.75M9 11.25h6.75M9 15.75h6.75M5.25 6.75h.008v.008H5.25V6.75zm.008 4.5h.008v.008H5.25v-.008zm0 4.5h.008v.008H5.25v-.008zm13.5-9h.008v.008h-.008V6.75zm.008 4.5h.008v.008h-.008v-.008zm0 4.5h.008v.008h-.008v-.008z" />
                    </svg>
                    <span>HotelAdmin</span>
                </a>
            </div>
            <nav class="mt-4 px-2">
                <a href="#" class="flex items-center px-3 py-3 rounded-lg bg-gray-700 text-white">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                    </svg>
                    <span class="ml-3">Bảng điều khiển</span>
                </a>
                <a href="#" class="flex items-center px-3 py-3 mt-2 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
                    </svg>
                    <span class="ml-3">Quản lý Phòng</span>
                </a>
                <a href="#" class="flex items-center px-3 py-3 mt-2 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-6h.008v.008H12v-.008z" />
                    </svg>
                    <span class="ml-3">Đặt phòng</span>
                </a>
                <a href="#" class="flex items-center px-3 py-3 mt-2 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                    </svg>
                    <span class="ml-3">Khách hàng</span>
                </a>
                <a href="#" class="flex items-center px-3 py-3 mt-2 rounded-lg text-gray-300 hover:bg-gray-700 hover:text-white">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-1.002 1.118-1.002h1.078c.558 0 1.028.46 1.118 1.002l.068.408c.46.275.908.616 1.309.997l.344-.269c.437-.34.99-.304 1.37.09l.764.764c.394.394.43.933.09 1.37l-.269.344c.381.4.722.848.997 1.309l.408.068c.542.09.962.56.962 1.118v1.078c0 .558-.46.988-1.002 1.118l-.408.068c-.275.46-.616.908-.997 1.309l.269.344c.34.437.304.99-.09 1.37l-.764.764a.99.99 0 01-1.37.09l-.344-.269c-.4.381-.848.722-1.309.997l-.068.408c-.09.542-.56.962-1.118.962h-1.078c-.558 0-1.028-.46-1.118-.962l-.068-.408a6.51 6.51 0 01-1.309-.997l-.344.269a.99.99 0 01-1.37-.09l-.764-.764a.99.99 0 01-.09-1.37l.269-.344a6.51 6.51 0 01-.997-1.309l-.408-.068c-.542-.09-1.002-.56-1.002-1.118v-1.078c0-.558.46-1.028 1.002-1.118l.408-.068c.275-.46.616-.908.997-1.309l-.269-.344a.99.99 0 01.09-1.37l.764-.764c.394-.394.933-.43 1.37-.09l.344.269c.4-.381.848-.722 1.309-.997l.068-.408zM12 15a3 3 0 100-6 3 3 0 000 6z" />
                    </svg>
                    <span class="ml-3">Cài đặt</span>
                </a>
            </nav>
        </aside>

        <!-- Main content -->
        <div class="flex-1 flex flex-col overflow-hidden md:ml-64">
            <!-- Header -->
            <header class="flex justify-between items-center p-4 bg-white border-b border-gray-200 shadow-sm">
                <div class="flex items-center">
                    <!-- Nút mở/đóng Sidebar cho mobile -->
                    <button class="text-gray-500 hover:text-gray-700 md:hidden" id="sidebar-toggle">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                        </svg>
                    </button>
                    <h1 class="text-2xl font-semibold text-gray-800 ml-3">Quản lý Trạng thái Phòng</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="p-2 text-gray-500 bg-gray-100 rounded-full hover:bg-gray-200">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.31 5.072A23.847 23.847 0 009.143 17.082" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 17.25a3 3 0 01-6 0v-4.5a3 3 0 016 0v4.5z" />
                        </svg>
                    </button>
                    <img class="w-10 h-10 rounded-full" src="https://placehold.co/100x100/E2E8F0/4A5568?text=Admin" alt="Admin Avatar">
                </div>
            </header>

            <!-- Main content area -->
            <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6">
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white rounded-lg shadow p-5 flex items-center space-x-4">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-500">
                            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h6.75M9 11.25h6.75M9 15.75h6.75M5.25 6.75h.008v.008H5.25V6.75zm.008 4.5h.008v.008H5.25v-.008zm0 4.5h.008v.008H5.25v-.008zm13.5-9h.008v.008h-.008V6.75zm.008 4.5h.008v.008h-.008v-.008zm0 4.5h.008v.008h-.008v-.008z" /></svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Tổng số phòng</p>
                            <p class="text-2xl font-semibold text-gray-800" id="total-rooms">12</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-5 flex items-center space-x-4">
                        <div class="p-3 rounded-full bg-green-100 text-green-500">
                            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" /></svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Đang trống</p>
                            <p class="text-2xl font-semibold text-gray-800" id="available-rooms">4</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-5 flex items-center space-x-4">
                        <div class="p-3 rounded-full bg-red-100 text-red-500">
                            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" /></svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Có khách</p>
                            <p class="text-2xl font-semibold text-gray-800" id="occupied-rooms">6</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow p-5 flex items-center space-x-4">
                        <div class="p-3 rounded-full bg-blue-100 text-blue-500">
                            <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.998 0M2.985 19.644L6.166 16.46" /></svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Cần dọn dẹp</p>
                            <p class="text-2xl font-semibold text-gray-800" id="cleaning-rooms">1</p>
                        </div>
                    </div>
                </div>

                <!-- Room Grid -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="room-grid">
                    <!-- Các thẻ phòng sẽ được chèn vào đây bằng JavaScript -->
                </div>
            </main>
        </div>
    </div>

    <!-- Modal Check-in -->
    <div id="checkin-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 transition-opacity duration-300 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md transform transition-all scale-95 opacity-0" id="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-gray-800">Check-in cho phòng <span id="modal-room-name"></span></h2>
                <button id="close-modal-btn" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <form id="checkin-form">
                <input type="hidden" id="modal-room-id">
                <div class="mb-4">
                    <label for="guest-name" class="block text-sm font-medium text-gray-700 mb-1">Tên khách hàng</label>
                    <input type="text" id="guest-name" name="guest-name" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div>
                        <label for="checkin-date" class="block text-sm font-medium text-gray-700 mb-1">Ngày check-in</label>
                        <input type="date" id="checkin-date" name="checkin-date" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div>
                        <label for="checkout-date" class="block text-sm font-medium text-gray-700 mb-1">Ngày check-out</label>
                        <input type="date" id="checkout-date" name="checkout-date" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" id="cancel-modal-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300">Hủy</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Xác nhận Check-in</button>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Dữ liệu demo ban đầu
            const initialRooms = [
                { id: 101, type: 'Phòng Standard', status: 'available', guestName: '', checkIn: '', checkOut: '' },
                { id: 102, type: 'Phòng Standard', status: 'occupied', guestName: 'Nguyễn Văn A', checkIn: '2025-11-01', checkOut: '2025-11-05' },
                { id: 103, type: 'Phòng Deluxe', status: 'available', guestName: '', checkIn: '', checkOut: '' },
                { id: 104, type: 'Phòng Suite', status: 'cleaning', guestName: '', checkIn: '', checkOut: '' },
                { id: 201, type: 'Phòng Standard', status: 'occupied', guestName: 'Trần Thị B', checkIn: '2025-11-02', checkOut: '2025-11-04' },
                { id: 202, type: 'Phòng Deluxe', status: 'maintenance', guestName: '', checkIn: '', checkOut: '' },
                { id: 203, type: 'Phòng Standard', status: 'available', guestName: '', checkIn: '', checkOut: '' },
                { id: 204, type: 'Phòng Suite', status: 'occupied', guestName: 'Lê Văn C', checkIn: '2025-10-30', checkOut: '2025-11-10' },
                { id: 301, type: 'Phòng Standard', status: 'available', guestName: '', checkIn: '', checkOut: '' },
                { id: 302, type: 'Phòng Deluxe', status: 'occupied', guestName: 'Phạm Thị D', checkIn: '2025-11-03', checkOut: '2025-11-06' },
                { id: 303, type: 'Phòng Suite', status: 'occupied', guestName: 'Vũ Văn E', checkIn: '2025-11-03', checkOut: '2025-11-07' },
                { id: 304, type: 'Phòng Standard', status: 'occupied', guestName: 'Đặng Thị F', checkIn: '2025-11-01', checkOut: '2025-11-03' },
            ];

            let rooms = JSON.parse(JSON.stringify(initialRooms)); // Tạo bản sao sâu để chỉnh sửa

            const roomGrid = document.getElementById('room-grid');
            const checkinModal = document.getElementById('checkin-modal');
            const modalContent = document.getElementById('modal-content');
            const closeModalBtn = document.getElementById('close-modal-btn');
            const cancelModalBtn = document.getElementById('cancel-modal-btn');
            const checkinForm = document.getElementById('checkin-form');
            const modalRoomName = document.getElementById('modal-room-name');
            const modalRoomId = document.getElementById('modal-room-id');
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');

            // --- Helper Functions ---

            function getStatusStyles(status) {
                switch (status) {
                    case 'available':
                        return {
                            badge: 'bg-green-100 text-green-800',
                            border: 'border-green-500',
                            text: 'Trống'
                        };
                    case 'occupied':
                        return {
                            badge: 'bg-red-100 text-red-800',
                            border: 'border-red-500',
                            text: 'Có khách'
                        };
                    case 'cleaning':
                        return {
                            badge: 'bg-blue-100 text-blue-800',
                            border: 'border-blue-500',
                            text: 'Đang dọn'
                        };
                    case 'maintenance':
                        return {
                            badge: 'bg-gray-100 text-gray-800',
                            border: 'border-gray-500',
                            text: 'Bảo trì'
                        };
                    default:
                        return {
                            badge: 'bg-gray-100 text-gray-800',
                            border: 'border-gray-500',
                            text: 'Không xác định'
                        };
                }
            }

            function getActionButtons(room) {
                switch (room.status) {
                    case 'available':
                        return `
                            <button data-action="check-in" data-id="${room.id}" class="w-full px-3 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700 transition-colors">
                                Check-in
                            </button>
                        `;
                    case 'occupied':
                        return `
                            <button data-action="check-out" data-id="${room.id}" class="w-full px-3 py-2 bg-yellow-500 text-white rounded-md text-sm font-medium hover:bg-yellow-600 transition-colors">
                                Check-out
                            </button>
                        `;
                    case 'cleaning':
                        return `
                            <button data-action="finish-cleaning" data-id="${room.id}" class="w-full px-3 py-2 bg-green-600 text-white rounded-md text-sm font-medium hover:bg-green-700 transition-colors">
                                Hoàn tất dọn
                            </button>
                        `;
                    case 'maintenance':
                        return `
                            <button data-action="finish-maintenance" data-id="${room.id}" class="w-full px-3 py-2 bg-gray-600 text-white rounded-md text-sm font-medium hover:bg-gray-700 transition-colors">
                                Hoàn tất bảo trì
                            </button>
                        `;
                    default:
                        return '';
                }
            }

            function getMaintenanceButton(room) {
                 if (room.status !== 'maintenance') {
                    return `
                        <button data-action="maintenance" data-id="${room.id}" class="mt-2 w-full px-3 py-2 bg-gray-200 text-gray-700 rounded-md text-sm font-medium hover:bg-gray-300 transition-colors">
                            Bảo trì
                        </button>
                    `;
                 }
                 return '';
            }

            // --- Render Functions ---

            function renderRoomGrid() {
                if (!roomGrid) return;
                roomGrid.innerHTML = ''; // Xóa lưới cũ
                
                let available = 0, occupied = 0, cleaning = 0;

                rooms.forEach(room => {
                    const status = getStatusStyles(room.status);

                    // Đếm trạng thái
                    if (room.status === 'available') available++;
                    if (room.status === 'occupied') occupied++;
                    if (room.status === 'cleaning') cleaning++;
                    
                    const roomCard = `
                        <div class="bg-white rounded-lg shadow-md overflow-hidden transition-all hover:shadow-lg border-t-4 ${status.border}">
                            <!-- Phần tiêu đề thẻ -->
                            <div class="p-4 border-b border-gray-200">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-xl font-bold text-gray-800">Phòng ${room.id}</h3>
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold ${status.badge}">
                                        ${status.text}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-500 mt-1">${room.type}</p>
                            </div>
                            
                            <!-- Phần nội dung thẻ -->
                            <div class="p-4 min-h-[100px]">
                                ${room.status === 'occupied' ? `
                                    <div>
                                        <p class="text-sm font-medium text-gray-700">Khách: 
                                            <span class="font-normal text-gray-600">${room.guestName}</span>
                                        </p>
                                        <p class="text-sm font-medium text-gray-700 mt-1">Check-in: 
                                            <span class="font-normal text-gray-600">${room.checkIn}</span>
                                        </p>
                                        <p class="text-sm font-medium text-gray-700 mt-1">Check-out: 
                                            <span class="font-normal text-gray-600">${room.checkOut}</span>
                                        </p>
                                    </div>
                                ` : `
                                    <p class="text-sm text-gray-400 italic">Không có thông tin khách.</p>
                                `}
                            </div>
                            
                            <!-- Phần chân thẻ (Hành động) -->
                            <div class="p-4 bg-gray-50 border-t border-gray-200">
                                ${getActionButtons(room)}
                                ${getMaintenanceButton(room)}
                            </div>
                        </div>
                    `;
                    roomGrid.innerHTML += roomCard;
                });

                // Cập nhật thẻ tóm tắt
                updateSummary(available, occupied, cleaning);
            }
            
            function updateSummary(available, occupied, cleaning) {
                document.getElementById('total-rooms').textContent = rooms.length;
                document.getElementById('available-rooms').textContent = available;
                document.getElementById('occupied-rooms').textContent = occupied;
                document.getElementById('cleaning-rooms').textContent = cleaning;
            }

            // --- Modal Functions ---

            function openModal(roomId) {
                const room = rooms.find(r => r.id === roomId);
                if (!room) return;

                modalRoomName.textContent = room.id;
                modalRoomId.value = room.id;
                
                // Đặt ngày check-in mặc định là hôm nay
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('checkin-date').value = today;

                checkinModal.classList.remove('hidden');
                setTimeout(() => {
                    checkinModal.classList.add('opacity-100');
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            }

            function closeModal() {
                modalContent.classList.add('scale-95', 'opacity-0');
                modalContent.classList.remove('scale-100', 'opacity-100');
                checkinModal.classList.remove('opacity-100');
                setTimeout(() => {
                    checkinModal.classList.add('hidden');
                    checkinForm.reset(); // Xóa form
                }, 300);
            }

            // --- Event Handlers ---

            function handleRoomAction(e) {
                const action = e.target.dataset.action;
                const id = parseInt(e.target.dataset.id);
                if (!action || !id) return;

                const roomIndex = rooms.findIndex(r => r.id === id);
                if (roomIndex === -1) return;

                switch (action) {
                    case 'check-in':
                        openModal(id);
                        break;
                    case 'check-out':
                        rooms[roomIndex].status = 'cleaning';
                        rooms[roomIndex].guestName = '';
                        rooms[roomIndex].checkIn = '';
                        rooms[roomIndex].checkOut = '';
                        renderRoomGrid();
                        break;
                    case 'finish-cleaning':
                    case 'finish-maintenance':
                        rooms[roomIndex].status = 'available';
                        renderRoomGrid();
                        break;
                    case 'maintenance':
                        rooms[roomIndex].status = 'maintenance';
                        rooms[roomIndex].guestName = '';
                        rooms[roomIndex].checkIn = '';
                        rooms[roomIndex].checkOut = '';
                        renderRoomGrid();
                        break;
                }
            }
            
            function handleCheckInSubmit(e) {
                e.preventDefault();
                const id = parseInt(modalRoomId.value);
                const guestName = document.getElementById('guest-name').value;
                const checkIn = document.getElementById('checkin-date').value;
                const checkOut = document.getElementById('checkout-date').value;

                const roomIndex = rooms.findIndex(r => r.id === id);
                if (roomIndex !== -1) {
                    rooms[roomIndex].status = 'occupied';
                    rooms[roomIndex].guestName = guestName;
                    rooms[roomIndex].checkIn = checkIn;
                    rooms[roomIndex].checkOut = checkOut;
                }
                
                closeModal();
                renderRoomGrid();
            }
            
            function handleSidebarToggle() {
                sidebar.classList.toggle('-translate-x-full');
            }

            // --- Initial Setup ---

            // Gán sự kiện
            roomGrid.addEventListener('click', handleRoomAction);
            closeModalBtn.addEventListener('click', closeModal);
            cancelModalBtn.addEventListener('click', closeModal);
            checkinForm.addEventListener('submit', handleCheckInSubmit);
            sidebarToggle.addEventListener('click', handleSidebarToggle);
            
            // Đóng sidebar nếu click ra ngoài trên mobile
            document.addEventListener('click', (e) => {
                if (!sidebar.contains(e.target) && !sidebarToggle.contains(e.target) && !sidebar.classList.contains('-translate-x-full')) {
                    if (window.innerWidth < 768) { // md breakpoint
                         handleSidebarToggle();
                    }
                }
            });

            // Render lần đầu
            renderRoomGrid();
        });
    </script>
</body>
</html>
